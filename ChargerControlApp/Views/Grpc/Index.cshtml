@{
    ViewData["Title"] = "gRPC 狀態";
    var activeTab = ViewBag.ActiveTab as string ?? "server";
    var stationState = ViewBag.StationState as string ?? "Unknown";
    var logMessages = ViewBag.LogMessages as List<string> ?? new List<string>();
}

<h2>gRPC 狀態</h2>

<ul class="nav nav-tabs" id="grpcTab" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="server-tab" data-bs-toggle="tab" data-bs-target="#server" type="button" role="tab">Server</button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="client-tab" data-bs-toggle="tab" data-bs-target="#client" type="button" role="tab">Client</button>
    </li>
</ul>
<div class="tab-content mt-3" id="grpcTabContent">
    <div class="tab-pane fade show active" id="server" role="tabpanel">
        <h4>gRPC Service 狀態</h4>
        <p>目前站台狀態：<strong>@stationState</strong></p>
        <h4>SwappingStationService Log</h4>
        <ul id="logList" style="max-height:300px;overflow:auto;">
            @foreach (var log in logMessages)
            {
                <li>@log</li>
            }
        </ul>
    </div>
    <div class="tab-pane fade" id="client" role="tabpanel">
        <h4>gRPC Client 狀態</h4>
        <h4>GrpcClientService Log</h4>
        <ul id="clientLogList" style="max-height:300px;overflow:auto;">
            @foreach (var log in logMessages)
            {
                <li>@log</li>
            }
        </ul>
    </div>
</div>

@section Scripts {
<script>
    function updateLogs() {
        fetch('/Grpc/GetLogs')
            .then(response => response.json())
            .then(data => {
                const logList = document.getElementById('logList');
                logList.innerHTML = '';
                data.forEach(function(log) {
                    const li = document.createElement('li');
                    li.textContent = log;
                    logList.appendChild(li);
                });
            });
    }

    function updateClientLogs() {
            fetch('/Grpc/GetClientLogs')
                .then(response => response.json())
                .then(data => {
                    const logList = document.getElementById('clientLogList');
                    logList.innerHTML = '';
                    data.forEach(function(log) {
                        const li = document.createElement('li');
                        li.textContent = log;
                        logList.appendChild(li);
                    });
                });
        }

    setInterval(updateLogs, 3000); // 每3秒更新一次
        setInterval(updateClientLogs, 3000); // 每3秒更新一次
</script>
}
